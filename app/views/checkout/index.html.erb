
<% cart %>
<% session[:cart] %>

<% if cart.present? %>
<h1>Your Order</h1>


<% cart.each do |furniture| %>
  <%= form_with url: cart_path(Furniture.find(furniture[0]).id, :quantity), method: :put do %>
    <h2>
      <%= Furniture.find(furniture[0]).title %> -
      $<%= Furniture.find(furniture[0]).price * furniture[1] %>
      <%= number_field_tag :quantity, value = furniture[1] %>
      <%= button_tag 'Update' %>
    </h2>
  <% end %>

  <%= button_to cart_path(Furniture.find(furniture[0]).id), method: :delete do %>
    Remove
  <% end %>
<% end %>

<% if !@province.present? %>
  <h2>Please enter your address before submitting your order</h2>

    <%= form_with url: user_path(current_user.id, :id, :address, :postal, :city), method: :put do |f| %>

      <div class="field">
        <%= f.label :address %><br />
        <%= f.text_field :address, autofocus: true, autocomplete: "address" %>
      </div>

      <div class="field">
        <%= f.label :postal %><br />
        <%= f.text_field :postal, autofocus: true, autocomplete: "postal" %>
      </div>

      <div class="field">
        <%= f.label :city %><br />
        <%= f.text_field :city, autofocus: true, autocomplete: "city" %>
      </div>

      <div class="field">
        <%= f.label :province %><br />
        <%= f.collection_select :province_id, Province.all, :id, :code, { :prompt => 'Select a Province' }, {class: 'form-control' } %>
      </div>

      <%= button_tag 'Update' %>
    <% end %>

  <% else %>

    <h2>Subtotal: $<%= subtotal.round(2) %></h2>
    <h2>PST: $<%= (subtotal * pst).round(2) %></h2>
    <h2>HST: $<%= (subtotal * hst).round(2) %></h2>
    <h2>GST: $<%= (subtotal * gst).round(2) %></h2>
    <h2>Total: $<%= (subtotal + (subtotal * pst) + (subtotal * hst) + (subtotal * gst)).round(2) %></h2>

    <td><%= button_to 'Submit Order' ,{:controller => 'checkout', :action => 'create', :pst => pst, :hst => hst, :gst => gst}, {:method => :post, :remote => true} %></td>

<% end %>

<% else %>
  <h2>Your cart is empty.</h2>
<% end %>